# Препроцессор языка С
Чуть-чуть определений:<br/>
***Препроцессор С/С++ (англ. pre processor, предобработчик)*** — программа, подготавливающая код программы на языке `C/C++` к компиляции.<br/>
***Директива С*** - инструкции, записанные в тексте программы на СИ, и выполняемые до трансляции программы. Директивы препроцессора позволяют изменить текст программы,
например, заменить некоторые лексемы в тексте, вставить текст из другого файла, запретить трансляцию части текста и т.п. 
Все директивы препроцессора начинаются со знака `#`. После директив препроцессора точка с запятой не ставятся.<br/>
 
В компилятор языка программирования C входит препроцессор, который осуществляет подготовку программы к компиляции. 
Среди прочего он, например, включает содержимое одних файлов в другие, заменяет в тексте исходного кода имена констант на их значения, 
удаляет символы конца строки (которые нужны только программисту, чтобы код можно было легко читать, но не нужны компилятору). 
Что-то препроцессор делает по-умолчанию, а какие-то его действия программируются с помощью специальных директив в исходном коде. 
Директивы препроцессора начинаются со знака `#` и заканчиваются переходом на новую строку. 
В отличие от законченного выражения на языке C, в конце директив не надо ставить точку с запятой. 
В этой статье мы рассмотрим **включаемые файлы (директива include)** и **условную компиляцию**.

## Директива `#include`
При обнаружении директив `#include "..."` и `#include <...>`, где «…» — имя файла, препроцессор читает содержимое указанного файла, 
выполняет директивы и замены (подстановки), заменяет директиву `#include` на директиву `#line` и обработанное содержимое файла.<br/><br/>
***Директива `#line` указывает препроцессору установить сообщаемые значения компилятора для номера строки и имени файла в заданный номер строки и имя файла.*** <br/><br/>
Для `#include "..." ` поиск файла выполняется в текущей папке и папках, указанных в командной строке компилятора.<br/>
Для `#include <...>` поиск файла выполняется в папках, содержащих файлы стандартной библиотеки (пути к этим папкам зависят от реализации компилятора).<br/>

При обнаружении директивы `#include` последовательность-лексем не совпадающей ни с одной из предыдущих форм, рассматривает последовательность лексем как текст, 
который в результате всех макроподстановок должен дать `#include <...>` или `#include "..."`. 
Сгенерированная таким образом директива далее будет интерпретироваться в соответствии с полученной формой.

Включаемые файлы обычно содержат:<br/>
1. Объявления функций;<br/>
2. Объявления глобальных переменных;<br/>
3. Определения интерфейсов;<br/>
4. Определения типов данных;<br/>
  и другое...
  
Директива `#include` обычно указывается в начале файла (в заголовке), поэтому включаемые файлы называются заголовочными.

Пример включения файлов из стандартной библиотеки языка C.
```C
#include <math.h> // включение объявлений математических функций
#include <stdio.h> // включение объявлений функций ввода-вывода
```
Использование препроцессора считается неэффективным по следующим причинам:
1. Каждый раз при включении файлов выполняются директивы и замены (подстановки);<br/> Компилятор мог бы сохранять результаты препроцессирования для использования в будущем;<br/>
2. Множественные включения одного файла приходится предотвращать вручную с помощью директив условной компиляции;<br/> Компилятор мог бы выполнять эту задачу самостоятельно;<br/>

### Файлы `.h` и `.c`
Файл c расширение `.c` - файл исходного кода для программ `C` или `C++`. Он может включать в себя исходный код всей программы или может быть одними из многих исходных файлов, упомянутых в проекте.<br/>
Файл с расширением `.h` - заголовочные файл, который содержит различные переменные, константы и многочисленные функции, которые используются другими файлами внутри проекта. 
Это позволяет часто используемым функциям быть указанным только один раз и ссылаться на них в других файлах при необходимости.<br/>

## Условная компиляция
Препроцессор языка Си предоставляет возможность компиляции с условиями. Это допускает возможность существования различных версий одного кода. Обычно такой подход используется для настройки программы под платформу компилятора, состояние (отлаживаемый код может быть выделен в результирующем коде) или возможность проверки подключения файла строго один раз.

В общем случае, программисту необходимо использовать конструкцию типа:
```C
# ifndef FOO_H
# define FOO_H
...(код заголовочного файла)...
# endif
```
Такая «защита макросов» предотвращает двойное подключение заголовочного файла путём проверки существования этого макроса, который имеет то же самое имя, 
что и заголовочный файл. Определение макроса `FOO_H` происходит, когда заголовочный файл впервые обрабатывается препроцессором. 
Затем, если этот заголовочный файл вновь подключается, `FOO_H` уже определен, в результате чего препроцессор пропускает полностью текст этого заголовочного файла.

То же самое можно сделать, включив в заголовочный файл директиву:
```C
# pragma once
```
Условия препроцессора можно задавать несколькими способами, например:
```C
# ifdef x
...
# else
...
# endif
```
или
```C
# if x
...
# else
...
# endif
```
Этот способ часто используется в системных заголовочных файлах для проверки различных возможностей, определение которых может меняться в зависимости от платформы;

Большинство современных языков программирования не используют такие возможности, больше полагаясь на традиционные операторы условия if...then...else..., 
оставляя компилятору задачу извлечения бесполезного кода из компилируемой программы.

Вот, собственно, и всё :) <br/>
***#ЛюблюПрогу***
