# Динамическое программирование

## Определение

Наверное это лучшее определение динамики, которое я слышал

![markdown logo](https://sun4-12.userapi.com/s/v1/ig2/yopkjpYRdv0gBh_2gXB4DQ1rseK7mpbfEbNZ5TwyBleSbpREHUC64aJwQy5dwIqQYVhdNQ-Jpwzh-mP38xfjoGJH.jpg?size=976x100&quality=96&type=album)

В целом этого достаточно, чтобы понять о чем пойдет речь

## Основы

### Чтобы успешно решить задачу динамикой нужно: </br>
1) Состояние динамики: параметр(ы), однозначно задающие подзадачу. </br>
2) Значения начальных состояний. </br>
3) Переходы между состояниями: формула пересчёта. </br>
4) Порядок пересчёта. </br>
5) Положение ответа на задачу: иногда это сумма или, например, максимум из значений нескольких состояний. </br>

### Порядок пересчёта

Существует три порядка пересчёта:

1) Прямой порядок:

![markdown logo](https://hsto.org/storage3/f1f/36c/875/f1f36c87585e05a9beb692324fa6b72e.png)

Состояния последовательно пересчитывается исходя из уже посчитанных.

2) Обратный порядок:

![markdown logo](https://hsto.org/storage3/0ae/3a1/bf4/0ae3a1bf4aed4161e8375305693cbf69.png)

Обновляются все состояния, зависящие от текущего состояния.

3) Ленивая динамика:

![markdown logo](https://habrastorage.org/r/w1560/storage3/045/d67/fbe/045d67fbe78f0d724d75dd89a352cfe2.png)

Рекурсивная мемоизированная функция пересчёта динамики. Это что-то вроде поиска в глубину по ацикличному графу состояний, где рёбра — это зависимости между ними.

## Задача о рюкзаке

Разберем на пальцах как можно решить эту задачу используя приемы динамического программирования.

### Постановка задачи

У нас есть довольно вместительный рюкзак и дорогие вещи, которые можно в него положить.
Но вот беда — лямки рюкзака выдерживают, скажем, четыре килограмма, не больше.

А выбираем мы:

- из **ноутбука**, который весит три килограмма и стоит 2 000 долларов
- **бензопилы** — четыре килограмма мощи, которые обойдутся новому владельцу в 3 000 долларов;
- и мини-**гитары** — весит килограмм, а продать её можно за 1 500 долларов.

Нам нужно выбрать вещи наибольшей общей стоимости и не забывать про хилые лямки рюкзака.

### Разберем возможные пути решения задачи

#### Самый очевидный

Это полный перебор, конечно! Из трёх предметов можно составить всего восемь комбинаций.
Подсчитаем стоимость для каждой и выберем самый выгодный вариант:

![markdown logo](https://248006.selcdn.ru/main/upload/setka_images/11341220042021_a7153eb112dd97c0d9ca444343513c85f68afb72.png)

Пока предметов только три — вполне себе годное решение, но добавим ещё один — и вариантов станет 16, а для пяти их будет уже 32.

С добавлением каждого нового предмета число комбинаций удваивается, так что сложность такого алгоритма — O(2n). Это медленный способ.

### Приблизительное решение

Применим так называемый **жадный алгоритм**: на каждом шаге добавляем в рюкзак самый дорогой предмет, пока лимит веса не превышен.

В случае с нашими предметами — одним шагом дело бы и закончилось.
Мы сразу же взяли бы бензопилу за 3 000 долларов, потому что она самая дорогая.
А при добавлении любого нового предмета в рюкзаке уже был бы перевес.

Было ли наше решение оптимальным?
Нет, потому что гитару на пару с ноутбуком наш рюкзак тоже выдержит,
но стоят они 1 500 долларов + 2 000 долларов = 3 500 долларов, что больше 3 000 долларов.

### Оптимальное решение

Воспользуемся приёмами **динамического программирования**.
Разобьём задачу на подзадачи и будем последовательно их решать.
При этом на каждом следующем шаге используем результаты предыдущего.

Наглядно это можно представить в виде таблицы.
Её ещё называют таблицей мемоизации. Столбцы нашей соответствуют килограммам (от одного до четырёх), а строки — предметам (гитара, бензопила, ноутбук).

![markdown logo](https://sun9-41.userapi.com/s/v1/ig2/OSLeFPaj2Ok_RRHHS_vJqulxwmAQ3EDPshgD-4MA6909JerZ5CTEp50P5h0eX87cA64azzd6_cCQo_x9_8aZ7_lB.jpg?size=971x268&quality=96&type=album)
(таблица до заполнения)


 На пересечении, в ячейках, будем записывать общую стоимость предметов в рюкзаке.

 #### Гитара

 Для каждого столбца (та или иная грузоподъёмность рюкзака) нужно решить: класть гитару в рюкзак или нет.

 Так как гитара весит всего один килограмм, то она влезет уже на первом шаге. Поэтому в каждой ячейке первой строки напишем 1 500 — стоимость гитары.

 Мы заполнили строку целиком и узнали, что **промежуточный максимум для рюкзака в четыре килограмма составляет 1500 долларов**.

 ![markdown logo](https://sun4-16.userapi.com/s/v1/ig2/kfXj-Ca_jg9JorVy1HeEl-GVZvMI6Qyw4xfZEpZ51903sV84iww8_GMdY2u1zjEzJX4N6GZIcpzNJhz9bTt58-M9.jpg?size=978x274&quality=96&type=album)
 (Таблица для первого предмета — гитары)

 #### Бензопила

 На следующем этапе рассматриваем двух кандидатов — гитару и бензопилу.

 В рюкзаки, рассчитанные на один, два или три килограмма, бензопилу не положить, так что оставляем там гитару и максимум стоимости вещей 1 500 долларов.
 А вот для случая «четыре килограмма» обновляем максимум: кладём бензопилу стоимостью 3 000 долларов.

 ![markdown logo](https://sun9-68.userapi.com/s/v1/ig2/YoLAfcjIEslGlVR54wATe3r-Sy-IWpjmnw8qJd69N1R9N_-1H_my4YGYfiCX7pvC78e0H5P_ZebODLwJDCrsCKPD.jpg?size=980x276&quality=96&type=album)
 (Таблица для двух предметов — гитары и бензопилы)


 #### Ноутбук

Добавим последний предмет — ноутбук.

Для первых двух столбцов ничего не меняется, так как ничего, кроме гитары, в рюкзаки с грузоподъёмностью один и два килограмма положить не получится.

Зато в трёхкилограммовый рюкзак уже можно вместо гитары положить ноутбук — он дороже, обновляем максимум в этом столбце до 2 000 долларов.

Интереснее всего ситуация в последней ячейке: мы можем положить ноутбук, но он весит всего три килограмма, ещё один килограмм остаётся свободным.

И вот тут, наконец, пригодятся промежуточные результаты: мы узнали на предыдущих шагах максимальную стоимость для рюкзака,
который выдерживает один килограмм, — она равна 1 500 долларов.

В итоге получаем ноутбук + гитара = 3 500 долларов, это больше предыдущего максимума в 3 000 долларов. Так что ответ в задаче — **3 500 долларов**.


В общем случае формула для стоимости в каждой ячейке выглядит так:

``` S[i, j] = max (S[i−1, j], цена i-го предмета + S[i−1, j−вес i-го предмета]) ``` 

где ```i``` — номер строки, ```j``` — столбца.

То есть на каждом шаге мы выбираем между предыдущим максимумом и суммой, которую составляют стоимость текущего предмета и максимальная цена незанятого веса.
